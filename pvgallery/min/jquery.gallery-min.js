!function($){"use strict";var t=function(t,i){this.$element=t,this.defaults={pageSize:6,viewModel:0},this.options=$.extend({},this.defaults,i||{}),this.$wrapper=$(this.$element.attr("data-target")),this.$closeBtn=this.$wrapper.find(".close"),this.$realImg=this.$wrapper.find(".realimg"),this.$gallery=this.$wrapper.find(".gallery"),this.$videoWrapper=this.$wrapper.find(".video-wrapper"),this.$videoIcon=$('<i class="icon-video"></i>'),this.$prevBtn=this.$gallery.find(".prev"),this.$nextBtn=this.$gallery.find(".next"),this.$galleryThumbs=this.$wrapper.find(".gallery-thumbs"),this.$tmbPrevBtn=this.$galleryThumbs.find(".prev"),this.$tmbNextBtn=this.$galleryThumbs.find(".next"),this.$photoListWrapper=this.$galleryThumbs.find(".photolist-wrapper"),this.$photoList=this.$photoListWrapper.find("ul"),this.page=1,this.currentIndex=0,this.pageTotal=0,this.photoLen=0,this.tmbPicWidth=0};t.prototype={constructor:t,init:function(){this.pageTotal=this.getPageTotal(),this.photoLen=this.getTotalCount(),this.tmbPicWidth=this.getTmbPicWidth(),this.setPhotoListW(),this.initTmbImg(),this.evtHandler()},getTotalCount:function(){return this.$photoList.find("li").length},getPageTotal:function(){return Math.ceil(this.getTotalCount()/this.options.pageSize)},getTmbPicWidth:function(){return this.$photoList.find("li").outerWidth(!0)},setPhotoListW:function(){this.photoLen<this.options.pageSize&&(this.options.pageSize=this.photoLen),this.$photoListWrapper.width(this.options.pageSize*this.tmbPicWidth),this.$photoList.width(this.photoLen*this.tmbPicWidth)},initTmbImg:function(){var t=this;t.$photoList.find("li").each(function(i){var e=$(this).find("img"),n=$(this).attr("data-type"),s=$(this).attr("data-video-src");"video"===n&&$(this).append(t.$videoIcon);var h=e.attr("data-src");0===i&&t.tmbPicSelected(),e.attr("src",h)})},evtHandler:function(){var t=this;t.refreshBtn(),0===this.options.viewModel?t.$element.click(function(){t.show()}):t.$element.find(".realimg").click(function(){t.show()}),t.$closeBtn.click(function(){t.close()}),t.$photoList.find("li").each(function(i){$(this).click(function(){t.currentIndex=i,t.tmbPicSelected(),t.showPic(),t.refreshBtn()})}),t.$tmbNextBtn.click(function(){t.tmbNextPage()}),t.$tmbPrevBtn.click(function(){t.tmbPrevPage()}),t.$nextBtn.click(function(){t.nextItem()}),t.$prevBtn.click(function(){t.prevItem()})},disabledBtn:function(t){return $(t).attr("disabled",!0)},enabledBtn:function(t){return $(t).attr("disabled",!1)},refreshBtn:function(){this.pageTotal<=1?(this.disabledBtn(this.$tmbPrevBtn),this.disabledBtn(this.$tmbNextBtn)):(1===this.page?this.disabledBtn(this.$tmbPrevBtn):this.enabledBtn(this.$tmbPrevBtn),this.page===this.pageTotal?this.disabledBtn(this.$tmbNextBtn):this.enabledBtn(this.$tmbNextBtn)),0===this.currentIndex?this.disabledBtn(this.$prevBtn):this.enabledBtn(this.$prevBtn),this.currentIndex===this.photoLen-1?this.disabledBtn(this.$nextBtn):this.enabledBtn(this.$nextBtn)},show:function(){return 0===this.options.viewModel?this.$wrapper.fadeIn():this.$wrapper.addClass("gallery-mask").removeClass("gallery-visible").fadeIn()},close:function(){return 0===this.options.viewModel?this.$wrapper.fadeOut():this.$wrapper.addClass("gallery-visible").removeClass("gallery-mask")},showPic:function(t){var i=this.$photoList.find("li").eq(this.currentIndex).children("img").attr("src");this.$realImg.attr("src",i)},tmbPrevPage:function(){var t=this;t.$photoList.is(":animated")||(t.$photoList.animate({left:"+="+t.tmbPicWidth*t.options.pageSize+"px"},1e3),t.page--,t.refreshBtn())},tmbNextPage:function(){var t=this;t.$photoList.is(":animated")||(t.$photoList.animate({left:"-="+t.tmbPicWidth*t.options.pageSize+"px"},1e3),t.page++,t.refreshBtn())},nextItem:function(){if(this.currentIndex===this.photoLen-1)return this.currentIndex=this.photoLen-1,void this.refreshBtn();var t=this.$photoList.find("li:eq("+(this.currentIndex+1)+")").find("img").attr("src");this.$realImg.attr("src",t),this.currentIndex++,this.tmbPicSelected(),this.currentIndex+1>this.page*this.options.pageSize&&this.$tmbNextBtn.trigger("click"),this.refreshBtn()},prevItem:function(){if(this.currentIndex<=0)return this.currentIndex=0,void this.refreshBtn();var t=this.$photoList.find("li:eq("+(this.currentIndex-1)+")").find("img").attr("src");this.$realImg.attr("src",t),this.currentIndex--,this.tmbPicSelected(),this.currentIndex<(this.page-1)*this.options.pageSize&&this.$tmbPrevBtn.trigger("click"),this.refreshBtn()},tmbPicSelected:function(){return this.$photoList.find("li:eq("+this.currentIndex+")").addClass("active").siblings().removeClass("active")},loadPic:function(){}},$.fn.pgallery=function(i){return this.each(function(){var e=$(this),n=new t(e,i);return n.init()})}}(jQuery);